<!--#include file="/parts/head.html" -->
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 id="title" data-navbaractive="navdevices" class="h2">Devices</h1>
          </div>
          <div class="alert alert-info" role="alert">These are the devices (GPUs and CPUs) detected by NemosMiner. Configuration changes made will become active in the next cycle.</div>

          <div id="toolbarenableddevices">
            <button id="disable-device" class="btn btn-danger" disabled>Disable Device</button>
          </div>

          <h3 class="mt-4">Enabled Devices</h3>

          <table id="enableddevices" class="table"
            data-toolbar="#toolbarenableddevices"
            data-click-to-select="true"
            data-cache="true"
            data-toggle="table"
            data-icons="icons"
            data-show-button-text="true"
            data-filter-control="true"
            data-disable-control-when-search="true"
            data-show-search-clear-button="true"
            data-show-columns="true"
            data-show-toggle="true"
            data-show-refresh="true"
            data-detail-view="true"
            data-detail-formatter="detailFormatter"
            data-url="/devices/enabled"
            data-response-handler="formatDevices"
            data-sort-name="Name"
            data-sort-order="asc"
            >

            <thead>
              <tr>
                <th data-field="state" data-checkbox="true"></th>
                <th data-field="Name" data-sortable="true">Name</th>
                <th data-field="Vendor" data-sortable="true">Vendor</th>
                <th data-field="Model" data-sortable="true">Model</th>
                <th data-field="Type" data-sortable="true" data-visible="false">Type</th>
                <th data-field="Status" data-sortable="true">Status</th>
                <th data-field="tMemory" data-sortable="true">Memory</th>
                <th data-field="tCores" data-sortable="true">Cores/Stream Processors</th>
                <th data-field="tClockSpeed" data-sortable="true">Clock Speed</th>
                <th data-field="tDriverVersionCIM">Driver Version (CIM)</th>
                <th data-field="tDriverVersionOpenCL">Driver Version (OpenCL)</th>
                <th data-field="CUDAVersion">CUDA Version</th>
                <th data-field="ConfiguredPowerUsage" data-align="right" data-visible="false" data-sortable="true" data-formatter="formatWatt">Configured Power Usage</th>
                <th data-field="Bus" data-visible="false" data-sortable="true">PCI Bus Id</th>
                <th data-field="Bus_Index" data-visible="false" data-sortable="true">Bus_Index</th>
                <th data-field="Bus_Type_Index" data-visible="false" data-sortable="true">Bus_Type_Index</th>
                <th data-field="Bus_Vendor_Index" data-visible="false" data-sortable="true">Bus_Vendor_Index</th>
                <th data-field="Bus_Platform_Index" data-visible="false" data-sortable="true">Bus_Platform_Index</th>
                <th data-field="Id" data-visible="false" data-sortable="true">Id</th>
                <th data-field="Index" data-visible="false" data-sortable="true">Index</th>
                <th data-field="PlatformId" data-visible="false" data-sortable="true">PlatformId</th>
                <th data-field="PlatformId_Index" data-visible="false" data-sortable="true">PlatformId_Index</th>
                <th data-field="Slot" data-visible="false" data-sortable="true">Slot</th>
                <th data-field="Type_Id" data-visible="false" data-sortable="true">Type_Id</th>
                <th data-field="Type_Index" data-visible="false" data-sortable="true">Type_Index</th>
                <th data-field="Type_PlatformId_Index" data-visible="false" data-sortable="true">Type_PlatformId_Index</th>
                <th data-field="Type_Slot" data-visible="false" data-sortable="true">Type_Slot</th>
                <th data-field="Type_Vendor_Id" data-visible="false" data-sortable="true">Type_Vendor_Id</th>
                <th data-field="Type_Vendor_Index" data-visible="false" data-sortable="true">Type_Vendor_Index</th>
                <th data-field="Type_Vendor_Slot" data-visible="false" data-sortable="true">Type_Vendor_Slot</th>
                <th data-field="Vendor_Id" data-visible="false" data-sortable="true">Vendor_Id</th>
                <th data-field="Vendor_Index" data-visible="false" data-sortable="true">Vendor_Index</th>
                <th data-field="Vendor_Slot" data-visible="false" data-sortable="true">Vendor_Slot</th>
                <th data-field="tState" data-sortable="true" data-visible="false">State</th>
              </tr>
            </thead>
          </table>

          <h3 class="mt-4">Disabled Devices</h3>

          <div id="toolbardisableddevices">
              <button id="enable-device" class="btn btn-success" disabled>Enable Device</button>
          </div>

          <table id="disableddevices" class="table"
            data-toolbar="#toolbardisableddevices"
            data-click-to-select="true"
            data-cache="true"
            data-toggle="table"
            data-icons="icons"
            data-show-button-text="true"
            data-filter-control="true"
            data-disable-control-when-search="true"
            data-show-search-clear-button="true"
            data-show-columns="true"
            data-show-toggle="true"
            data-show-refresh="true"
            data-detail-view="true"
            data-detail-formatter="detailFormatter"
            data-url="/devices/disabled"
            data-response-handler="formatDevices"
            data-sort-name="Name"
            data-sort-order="asc"
            >

            <thead>
              <tr>
                <th data-field="state" data-checkbox="true"></th>
                <th data-field="Name" data-sortable="true">Name</th>
                <th data-field="Vendor" data-sortable="true">Vendor</th>
                <th data-field="Model" data-sortable="true">Model</th>
                <th data-field="Type" data-sortable="true" data-visible="false">Type</th>
                <th data-field="Status" data-sortable="true">Status</th>
                <th data-field="tMemory" data-sortable="true">Memory</th>
                <th data-field="tCores" data-sortable="true">Cores/Stream Processors</th>
                <th data-field="tClockSpeed" data-sortable="true">Clock Speed</th>
                <th data-field="tDriverVersionCIM">Driver Version (CIM)</th>
                <th data-field="tDriverVersionOpenCL">Driver Version (OpenCL)</th>
                <th data-field="CUDAVersion">CUDA Version</th>
                <th data-field="ConfiguredPowerUsage" data-align="right" data-visible="false" data-sortable="true" data-formatter="formatWatt">Configured Power Usage</th>
                <th data-field="Bus" data-visible="false" data-sortable="true">PCI Bus Id</th>
                <th data-field="Bus_Index" data-visible="false" data-sortable="true">Bus_Index</th>
                <th data-field="Bus_Type_Index" data-visible="false" data-sortable="true">Bus_Type_Index</th>
                <th data-field="Bus_Vendor_Index" data-visible="false" data-sortable="true">Bus_Vendor_Index</th>
                <th data-field="Bus_Platform_Index" data-visible="false" data-sortable="true">Bus_Platform_Index</th>
                <th data-field="Id" data-visible="false" data-sortable="true">Id</th>
                <th data-field="Index" data-visible="false" data-sortable="true">Index</th>
                <th data-field="PlatformId" data-visible="false" data-sortable="true">PlatformId</th>
                <th data-field="PlatformId_Index" data-visible="false" data-sortable="true">PlatformId_Index</th>
                <th data-field="Slot" data-visible="false" data-sortable="true">Slot</th>
                <th data-field="Type_Id" data-visible="false" data-sortable="true">Type_Id</th>
                <th data-field="Type_Index" data-visible="false" data-sortable="true">Type_Index</th>
                <th data-field="Type_PlatformId_Index" data-visible="false" data-sortable="true">Type_PlatformId_Index</th>
                <th data-field="Type_Slot" data-visible="false" data-sortable="true">Type_Slot</th>
                <th data-field="Type_Vendor_Id" data-visible="false" data-sortable="true">Type_Vendor_Id</th>
                <th data-field="Type_Vendor_Index" data-visible="false" data-sortable="true">Type_Vendor_Index</th>
                <th data-field="Type_Vendor_Slot" data-visible="false" data-sortable="true">Type_Vendor_Slot</th>
                <th data-field="Vendor_Id" data-visible="false" data-sortable="true">Vendor_Id</th>
                <th data-field="Vendor_Index" data-visible="false" data-sortable="true">Vendor_Index</th>
                <th data-field="Vendor_Slot" data-visible="false" data-sortable="true">Vendor_Slot</th>
                <th data-field="tState" data-sortable="true" data-visible="false">State</th>
              </tr>
            </thead>
          </table>

          <div id="unsupporteddevices" style="visibility: hidden">
            <h3 class="mt-4">Unsupported Devices</h3>

            <table id="tableunsupporteddevices" class="table"
            data-click-to-select="true"
            data-cache="true"
            data-toggle="table"
            data-icons="icons"
            data-show-button-text="true"
            data-filter-control="true"
            data-disable-control-when-search="true"
            data-show-search-clear-button="true"
            data-show-columns="true"
            data-show-toggle="true"
            data-show-refresh="true"
            data-detail-view="true"
            data-detail-formatter="detailFormatter"
            data-url="/devices/unsupported"
            data-response-handler="formatDevices"
            data-sort-name="Name"
            data-sort-order="asc"
              >

              <thead>
                <tr>
                  <th data-field="state" data-checkbox="true"></th>
                  <th data-field="Name" data-sortable="true">Name</th>
                  <th data-field="Vendor" data-sortable="true">Vendor</th>
                  <th data-field="Model" data-sortable="true">Model</th>
                  <th data-field="Type" data-sortable="true" data-visible="false">Type</th>
                  <th data-field="tMemory" data-sortable="true">Memory</th>
                  <th data-field="tCores" data-sortable="true">Cores/Stream Processors</th>
                  <th data-field="tClockSpeed" data-sortable="true">Clock Speed</th>
                  <th data-field="tDriverVersionCIM">Driver Version (CIM)</th>
                  <th data-field="tDriverVersionOpenCL">Driver Version (OpenCL)</th>
                  <th data-field="CUDAVersion">CUDA Version</th>
                  <th data-field="ConfiguredPowerUsage" data-align="right" data-visible="false" data-sortable="true" data-formatter="formatWatt">Configured Power Usage</th>
                  <th data-field="Bus" data-visible="false" data-sortable="true">PCI Bus Id</th>
                  <th data-field="Bus_Index" data-visible="false" data-sortable="true">Bus_Index</th>
                  <th data-field="Bus_Type_Index" data-visible="false" data-sortable="true">Bus_Type_Index</th>
                  <th data-field="Bus_Vendor_Index" data-visible="false" data-sortable="true">Bus_Vendor_Index</th>
                  <th data-field="Bus_Platform_Index" data-visible="false" data-sortable="true">Bus_Platform_Index</th>
                  <th data-field="Id" data-visible="false" data-sortable="true">Id</th>
                  <th data-field="Index" data-visible="false" data-sortable="true">Index</th>
                  <th data-field="PlatformId" data-visible="false" data-sortable="true">PlatformId</th>
                  <th data-field="PlatformId_Index" data-visible="false" data-sortable="true">PlatformId_Index</th>
                  <th data-field="Slot" data-visible="false" data-sortable="true">Slot</th>
                  <th data-field="Type_Id" data-visible="false" data-sortable="true">Type_Id</th>
                  <th data-field="Type_Index" data-visible="false" data-sortable="true">Type_Index</th>
                  <th data-field="Type_PlatformId_Index" data-visible="false" data-sortable="true">Type_PlatformId_Index</th>
                  <th data-field="Type_Slot" data-visible="false" data-sortable="true">Type_Slot</th>
                  <th data-field="Type_Vendor_Id" data-visible="false" data-sortable="true">Type_Vendor_Id</th>
                  <th data-field="Type_Vendor_Index" data-visible="false" data-sortable="true">Type_Vendor_Index</th>
                  <th data-field="Type_Vendor_Slot" data-visible="false" data-sortable="true">Type_Vendor_Slot</th>
                  <th data-field="Vendor_Id" data-visible="false" data-sortable="true">Vendor_Id</th>
                  <th data-field="Vendor_Index" data-visible="false" data-sortable="true">Vendor_Index</th>
                  <th data-field="Vendor_Slot" data-visible="false" data-sortable="true">Vendor_Slot</th>
                  <th data-field="tState" data-sortable="true" data-visible="false">State</th>
                </tr>
              </thead>
            </table>
          </div>
<!-- Start of page scripts -->
          <script type='text/javascript'>
            function formatDevices(data) {
              // This function can alter the returned data before building the table, formatting it in a way
              // that is easier to display and manipulate in a table
              $.each(data, function(index, item) {
                // Format the device(s)
                if (item.OpenCL) item.tMemory = formatBytes(item.OpenCL.GlobalMemSize);
                else item.tMemory = 'N/A';

                if (item.OpenCL) item.tClockSpeed = item.OpenCL.MaxClockFrequency;
                else if (item.CIM) item.tClockSpeed = item.CIM.MaxClockSpeed;
                else item.tClockSpeed = 'N/A';

                if (item.CIM) item.tDriverVersionCIM = item.CIM.DriverVersion;
                else item.tDriverVersionCIM = 'N/A';

                if (item.OpenCL) item.tDriverVersionOpenCL = item.OpenCL.DriverVersion;
                else item.tDriverVersionOpenCL = 'N/A';

                if (item.OpenCL) item.tCores = item.OpenCL.MaxComputeUnits;
                else if (item.CIM) item.tCores = item.CIM.NumberOfLogicalProcessors;
                else item.tCores = 'N/A';

                // Format device state
                const enumstatus = ["Enabled", "Disabled", "Unsupported"];
                item.tState = enumstatus[item.State];
              });
              return data;
            }

            $(document).ready(function () {
              $(function () {
                $('#disable-device').click(function () {
                  var $table = $('#enableddevices')
                  var command = 'functions/config/device/disable?ExcludeDeviceName=' + encodeURIComponent($table.bootstrapTable('getSelections').map(item => item.Name))
                  $('.modal-body').load(command, function() {
                    $('.modal-title').text($('#disable-device').text());
                    $('#myModal').modal({show:true});
                  });
                  $('#enableddevices').bootstrapTable('refresh');
                  $('#disableddevices').bootstrapTable('refresh');
                });
              });

              $(function () {
                $('#enable-device').click(function () {
                  var $table = $('#disableddevices')
                  var command = 'functions/config/device/enable?DeviceName=' + encodeURIComponent($table.bootstrapTable('getSelections').map(item => item.Name))
                  $('.modal-body').load(command, function() {
                    $('.modal-title').text($('#enable-device').text());
                    $('#myModal').modal({show:true});
                  });
                  $('#enableddevices').bootstrapTable('refresh');
                  $('#disableddevices').bootstrapTable('refresh');
                });
              });

              $(function() {
                $.ajax({url: '/devices/unsupported', 
                  success: function(result) {
                    if (result == "") {
                      document.getElementById("unsupporteddevices").style.visibility="hidden";
                    } else {
                      document.getElementById("unsupporteddevices").style.visibility="visible";
                    }
                  }
                });
              });

              $('#enableddevices').on('all.bs.table', function () {
                try {
                  if ($('#enableddevices').bootstrapTable('getSelections').length >= 1) {
                    document.getElementById('disable-device').disabled = false;
                  } else {
                    document.getElementById('disable-device').disabled = true;
                  }
                } catch {}
              });

              $('#disableddevices').on('all.bs.table', function () {
                try {
                  if ($('#disableddevices').bootstrapTable('getSelections').length >= 1) {
                    document.getElementById('enable-device').disabled = false;
                  } else {
                    document.getElementById('enable-device').disabled = true;
                  }
                } catch {}
              });
            });
          </script>
<!-- End of page scripts -->
<!--#include file="/parts/foot.html" -->